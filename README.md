# Diet recommendation via gut metabolic modeling

![overview][image-2]

## Installation
	$ git clone https://github.com/erolkavvas/diet_recommendation.git  
	$ cd diet_recommendation
	$ pip install -r requirements.txt  


## Workflow

1. Run **`$ python 01_sample_macs.py -f INPUT_DIR -s NUM_SAMPLES -o MAC_DIR [optional parameters...]`**
	- `INPUT_DIR`: See Input Data section below.
	- `NUM_SAMPLES`: Number of samples to generate (recommend 2 for test run, but \>1000 samples for meaningful results)
	- `MAC_DIR`: Path to MAC ensemble directory.
2. Run **`$ python 02_eval_macs.py -f MAC_DIR [--testset --bicthresh]`**
	- `MAC_DIR`: Path to MAC ensemble directory. Same as one used in step 1.
	- `testset`: Set True to evaluate MACs on test set. Default is False, which evaluates MACs over training set.
	- `bicthresh`: Threshold for selectings MACs based the Bayesian Information Criteria (BIC). Default is 10, as recommended in the literature.

`01_sample_macs.py` generates MAC samples, which requires performing the computationally expensive flux variability analysis (popFVA). `02_eval_macs.py` solves the MAC for the training set or testset and saves the MAC solutions. An ensemble of sampled MACs can be generated by running steps 1 and 2 multiple times for the same output directory. The input parameters must be consistent for the same output directory (except for NUM_SAMPLES). This is helpful because generating samples takes a long time so the simulations are likely to be interrupted at some point. See commented arguments in the python files for details on optional parameters.

## Input Data
- The following files are to be placed in INPUT\_DIR. The files should be named exactly as described below.
	- `MODEL_FILE.json` (**REQUIRED**). A genome-scale model in json format
	- `X_ALLELES_FILE.csv` (**REQUIRED**). A strain allele matrix with shape (strains, alleles). Alleles (columns) should have the same name as the gene ids in the genome-scale model (with \_num appended to specify the allele id) 
	- `Y_PHENOTYPES_FILE.csv` (**REQUIRED**). A strain phenotypes matrix with shape (strains, phenotypes)
	- `GENE_LIST_FILE.csv` (_OPTIONAL_). A pandas series or dataframe with index specifying the list of genes to limit the modeled alleles to. Highly recommended \<200 genes. otherwise sample deeply  
- `cobra_model/gene_to_pathways.json`. JSON object describing mapping of genes to pathways for the organism. Required for pathway enrichments.
- `gene_to_name.json`. JSON object describing mapping of gene ids to names. OPTIONAL.

[image-2]:	/Fig1_overview.png?raw=true